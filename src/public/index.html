<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Client web application</title> 
       <link href="style.css" rel="stylesheet" > 
       <script src="https://code.highcharts.com/highcharts.js"></script>
    </head>
    <body>
        <h1>Client web app</h1>

        <ul id="linklist">
            <a href='#' id="Chart_8">timesEachTeamWontheTossAndWonTheMatch</a>
            <a href='#' id="Chart_1">matchesPerYear</a>
            <a href='#' id="Chart_2">matchesWonPerTeamPerYear</a>  
            <a href="#" id="Chart_3">extraRunsConceededPerTeamInTheYear</a>
            <a href="#" id="Chart_4">top10EconomicalBowlersInTheYear</a>
            </ul>
       
        <div id="container" style="width: 80%; height: 400px; margin: 0 auto;"></div>        
        <script>

         const linklist = document.getElementById('linklist')
            
            linklist.addEventListener('click', (event) => {
                event.preventDefault();
                let id = event.target.id
                fetchAndCatch(event.target.textContent)
            })

         const fetchAndCatch = async(url) => {
                try {
                    const response = await fetch(`http://localhost:3000/${url}.json`, {
                        method: 'GET'
                    })
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`)
                    } else {
                        const data = await response.json()
                        eval(`${url}(data)`);
                    }
                } catch(error) {
                    console.error('Fetch error:', error)
                }
            }

            const matchesPerYear =  (data) => {                              
                Highcharts.chart('container', {
                    chart: {
                        type: 'line'
                    },
                    title: {
                        text: 'Matches Per Year',
                    },
                    xAxis: {
                        categories: Object.keys(data),
                        title: {
                            text: 'Year'
                        }
                    },
                    yAxis: {
                        title: {
                            text: 'Number of Matches'
                        }
                    },
                    series: [{
                        name: 'Values',
                        data: Object.values(data)
                    }]
                });

            }


            const matchesWonPerTeamPerYear = (data) => {
                Highcharts.chart('container', {
                        chart: {
                            type: 'bar'
                        },
                        title: {
                            text: 'Matches Won by Teams Each Year'
                        },
                        xAxis: {
                            categories: Object.keys(data),
                            title: {
                                text: 'Year'
                            }
                        },
                        yAxis: {
                            title: {
                                text: 'Number of Matches'
                            }
                        },
                        plotOptions: {
                            series: {
                                stacking: 'normal'
                            }
                        },
                        series: Object.entries(data[Object.keys(data)[0]]).map(([team, wins]) => ({
                            name: team,
                            data: Object.keys(data).map(year => data[year][team])
                        }))
                    });
            }

            const extraRunsConceededPerTeamInTheYear = (data) => {
                const teams = Object.keys(data);
                    const runsData = Object.values(data);

                    Highcharts.chart('container', {
                        chart: {
                            type: 'bar',
                        },
                        title: {
                            text: 'Total Extra Runs for Each Team',
                        },
                        xAxis: {
                            categories: teams,
                        },
                        yAxis: {
                            title: {
                                text: 'Number of Runs',
                            },
                        },
                        plotOptions: {
                    series: {
                        colorByPoint: true,
                        colors: ['#7cb5ec', '#434348', '#90ed7d', '#f7a35c', '#8085e9', '#f15c80', '#e4d354', '#2b908f'],
                    }
                },
                        series: [{
                            name: 'Extra Runs',
                            data: runsData,
                        }],
                    });
            }

            const top10EconomicalBowlersInTheYear = (data) => {
                Highcharts.chart('container', {
                chart: {
                    type: 'bar',
                },
                title: {
                    text: 'Top 10 Economical Bowlers in 2015',
                },
                xAxis: {
                    categories: data,
                },
                yAxis: {
                    title: {
                        text: 'Players',
                    },
                },
                plotOptions: {
                    series: {
                        colorByPoint: true,
                        colors: ['#7cb5ec', '#434348', '#90ed7d', '#f7a35c', '#8085e9', '#f15c80', '#e4d354', '#2b908f', '#f45b5b', '#91e8e1'],
                    }
                },
                series: [{
                    name: 'Players',
                    data: data.map(player => ({ name: player, y: 1 })),
                }],
            });
            }

            const timesEachTeamWontheTossAndWonTheMatch = (data)  => {
                    Highcharts.chart('container', {
                        chart: {
                            type: 'pie',
                            options3d: {
                                enabled: true,
                                alpha: 45
                            }
                        },
                        title: {
                            text: 'Number of times WonTheToss & Match'
                        },
                        plotOptions: {
                            pie: {
                                innerSize: 100,
                                depth: 45
                            }
                        },
                        series: [{
                            name: 'Wins',
                            data: Object.entries(data).map(([team, value]) => ({ name: team, y: value })),
                        }]
                    });
            }

        </script>
    </body>
</html>
