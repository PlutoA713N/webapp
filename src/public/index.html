<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Client web application</title> 
       <link href="style.css" rel="stylesheet" > 
       <script src="https://code.highcharts.com/highcharts.js"></script>
    </head>
    <body>
        <h1>Client web app</h1>

        <ul id="linklist">
            <a href='#' id="Chart_1">matchesPerYear</a>
            <a href='#' id="Chart_2">matchesWonPerTeamPerYear</a>  
            <a href="#" id="Chart_3">extraRunsConceededPerTeamInTheYear</a>
            <a href="#" id="Chart_4">top10EconomicalBowlersInTheYear</a>
            <a href='#' id="Chart_5">timesEachTeamWontheTossAndWonTheMatch</a>
            <a href='#' id="Chart_6">playerOfTheMatchAwardsForEachSeason</a>
            <a href='#' id="Chart_7">strikeRateOfABatsmanForEachSeason</a>
            <a href='#' id="Chart_8">highestTimesPlayerDismissedByAnotherPlayer</a>
            <a href='#' id="Chart_9">bowlerWithBestEconomy</a>
            </ul>
       
        <div id="container" style="width: 80%; height: 400px; margin: 0 auto;"></div>        
        <script>

         const linklist = document.getElementById('linklist')
            
            linklist.addEventListener('click', (event) => {
                event.preventDefault();
                let id = event.target.id
                fetchAndCatch(event.target.textContent)
            })

         const fetchAndCatch = async(url) => {
                try {
                    const response = await fetch(`http://localhost:3000/${url}.json`, {
                        method: 'GET'
                    })
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`)
                    } else {
                        const data = await response.json()
                        eval(`${url}(data)`);
                    }
                } catch(error) {
                    console.error('Fetch error:', error)
                }
            }

            const matchesPerYear =  (data) => {                              
                Highcharts.chart('container', {
                    chart: {
                        type: 'line'
                    },
                    title: {
                        text: 'Matches Per Year',
                    },
                    xAxis: {
                        categories: Object.keys(data),
                        title: {
                            text: 'Year'
                        }
                    },
                    yAxis: {
                        title: {
                            text: 'Number of Matches'
                        }
                    },
                    series: [{
                        name: 'Values',
                        data: Object.values(data)
                    }]
                });

            }


            const matchesWonPerTeamPerYear = (data) => {
                Highcharts.chart('container', {
                        chart: {
                            type: 'bar'
                        },
                        title: {
                            text: 'Matches Won by Teams Each Year'
                        },
                        xAxis: {
                            categories: Object.keys(data),
                            title: {
                                text: 'Year'
                            }
                        },
                        yAxis: {
                            title: {
                                text: 'Number of Matches'
                            }
                        },
                        plotOptions: {
                            series: {
                                stacking: 'normal'
                            }
                        },
                        series: Object.entries(data[Object.keys(data)[0]]).map(([team, wins]) => ({
                            name: team,
                            data: Object.keys(data).map(year => data[year][team])
                        }))
                    });
            }

            const extraRunsConceededPerTeamInTheYear = (data) => {
                const teams = Object.keys(data);
                    const runsData = Object.values(data);

                    Highcharts.chart('container', {
                        chart: {
                            type: 'bar',
                        },
                        title: {
                            text: 'Total Extra Runs for Each Team',
                        },
                        xAxis: {
                            categories: teams,
                        },
                        yAxis: {
                            title: {
                                text: 'Number of Runs',
                            },
                        },
                        plotOptions: {
                    series: {
                        colorByPoint: true,
                        colors: ['#7cb5ec', '#434348', '#90ed7d', '#f7a35c', '#8085e9', '#f15c80', '#e4d354', '#2b908f'],
                    }
                },
                        series: [{
                            name: 'Extra Runs',
                            data: runsData,
                        }],
                    });
            }

            const top10EconomicalBowlersInTheYear = (data) => {
                Highcharts.chart('container', {
                chart: {
                    type: 'bar'
                },
                title: {
                    text: 'Top 10 Economical Bowlers in the Year'
                },
                xAxis: {
                    categories: Object.keys(data),
                    title: {
                        text: 'Bowler'
                    }
                },
                yAxis: {
                    title: {
                        text: 'Economy Rate'
                    }
                },
                plotOptions: {
                    series: {
                        colorByPoint: true,
                        colors: ['#4CAF50', '#2196F3', '#FF9800', '#9C27B0', '#FFC107', '#607D8B', '#E91E63', '#795548', '#00BCD4', '#FF5722']
                    }
                },
                series: [{
                    name: 'Economy Rate',
                    data: Object.values(data)
                }]
            });

            }

            const timesEachTeamWontheTossAndWonTheMatch = (data)  => {
                    Highcharts.chart('container', {
                        chart: {
                            type: 'pie',
                            options3d: {
                                enabled: true,
                                alpha: 45
                            }
                        },
                        title: {
                            text: 'Number of times WonTheToss & Match'
                        },
                        plotOptions: {
                            pie: {
                                innerSize: 100,
                                depth: 45
                            }
                        },
                        series: [{
                            name: 'Wins',
                            data: Object.entries(data).map(([team, value]) => ({ name: team, y: value })),
                        }]
                    });
            }


            const playerOfTheMatchAwardsForEachSeason = (data) => {
                const seasons = Object.keys(data);


            Highcharts.chart('container', {
            chart: {
                type: 'column'
            },
            title: {
                text: 'Player of the Match Awards Each Season'
            },
            xAxis: {
                categories: Object.keys(data),
                title: {
                    text: 'Year'
                }
            },
            yAxis: {
                title: {
                    text: 'Number of Player of the Match Awards'
                }
            },
            series: Object.keys(data).map(year => ({
                name: year,
                data: Object.entries(data[year]).map(([playerName, awards]) => ({
                    name: playerName,
                    y: awards
                }))
            }))
        });
    }


    const highestTimesPlayerDismissedByAnotherPlayer = (data) => {
        const batsman = data['maxDismissed']
        const bowler = data['Bowler']
        const maxDismissals = data['maxDismissals']

        console.log(batsman, bowler, maxDismissals)

        console.log(batsman, bowler, maxDismissals)

        Highcharts.chart('container', {
        chart: {
            type: 'column'
        },
        title: {
            text: 'Highest Number of Times One Player Dismissed By Another Player'
        },
        xAxis: {
            categories: [`${batsman} (Batsman)`, `${bowler} (Bowler)`]
        },
        yAxis: {
            title: {
                text: 'Number of Dismissals'
            }
        },
        series: [{
            name: `${bowler} (Bowler)`,
            data: [{ y: maxDismissals, color: '#FFD700' }] 
        }]
        });

    }

    const strikeRateOfABatsmanForEachSeason = (data ) => {
        const years = Object.keys(data["V Kohli"]);
        const strikeRates = Object.values(data["V Kohli"]).map(parseFloat);

  Highcharts.chart('container', {
    chart: {
      type: 'line'
    },
    title: {
      text: 'Strike Rate of a Batsman for Each Season'
    },
    xAxis: {
      categories: years,
      title: {
        text: 'Year'
      }
    },
    yAxis: {
      title: {
        text: 'Strike Rate'
      }
    },
    series: [{
      name: 'V Kohli',
      data: strikeRates,
      color: 'lightgreen'
    }]
  });

    }



const bowlerWithBestEconomy = (bowlerData ) => {
    const bowlerName = Object.keys(bowlerData)[0];
    const bowlerStats = bowlerData[bowlerName];


    console.log(bowlerData, bowlerName, bowlerStats)

    Highcharts.chart('container', {
        chart: {
            type: 'bar'
        },
        title: {
            text: `Bowler Stats - ${bowlerName}`
        },
        xAxis: {
            categories: Object.keys(bowlerStats),
            title: {
                text: 'Stat'
            }
        },
        yAxis: {
            title: {
                text: 'Value'
            }
        },
        series: [{
            name: bowlerName,
            data: Object.values(bowlerStats)
        }]
    });
}
    
        </script>
    </body>
</html>
